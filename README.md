# solar-stack

MLOps 2 + 경량 LLMOps 오픈소스 스택(Compose).  
- 커스터마이징은 git/ 아래에만 저장 → 컨테이너에 바인드 마운트
- 외부 공개 포트는 Nginx 80/443만, 나머지는 내부 expose

## 🚧 프로젝트 진행 상황

**현재 단계**: 컨테이너별 연결 중간 이상 완성 (아직 완성되지 않음)
**마지막 업데이트**: 2025-08-19

### ✅ 완성된 부분
- 기본 Docker Compose 구조 설정
- 컨테이너별 환경변수 파일 구성
- Git 저장소 초기화 및 GitHub 연결
- 프로젝트 구조 및 설정 파일 정리

### 🔄 진행 중인 부분
- 컨테이너 간 네트워크 연결 설정
- 서비스 간 통신 및 의존성 관리
- 보안 설정 및 인증 연동

### ❌ 미완성 부분
- 전체 시스템 통합 테스트
- 프로덕션 환경 최적화
- 모니터링 및 로깅 시스템 완성
- 백업 및 복구 시스템

## 🐳 컨테이너 구성 요소

### 핵심 서비스
- **Nginx** (80/443) - 리버스 프록시 및 웹 서버
- **Keycloak** - 인증 및 권한 관리
- **PostgreSQL** - 메인 데이터베이스
- **Redis** - 캐싱 및 세션 저장소

### MLOps 도구
- **Airflow** - 워크플로우 관리
- **MLflow** - 머신러닝 실험 추적
- **Feast** - 피처 스토어
- **Grafana** - 모니터링 대시보드
- **Prometheus** - 메트릭 수집
- **Loki** - 로그 수집

### 데이터 플랫폼
- **Kafka** - 메시지 큐
- **MinIO** - 객체 저장소
- **Superset** - 데이터 시각화

### LLM 도구
- **LLM Serving** - 대규모 언어 모델 서빙
- **OpenMeter** - 사용량 측정

### 기타 서비스
- **InvoiceNinja** - 인보이스 관리
- **Portal App** - Django 기반 웹 애플리케이션

## 🚀 빠른 시작

```bash
make install    # 의존성 설치
make init       # 초기 설정
make run        # 서비스 실행
```

## ⚙️ 환경변수 설정

`compose/.env.*` 파일을 채우고 실행하세요. **비밀값은 Git에 커밋하지 마세요**.

### 필수 환경변수
- 데이터베이스 접속 정보
- API 키 및 시크릿
- 도메인 및 SSL 설정
- 서비스별 포트 설정

## 🔗 네트워크 구성

- **외부 접근**: Nginx 80/443 포트만 공개
- **내부 통신**: Docker 네트워크를 통한 서비스 간 통신
- **보안**: Keycloak을 통한 통합 인증

## 🌐 포트 정보

### 외부 공개 포트 (외부에서 접근 가능)
| 서비스 | 포트 | 설명 | 접근 방법 |
|--------|------|------|-----------|
| **Nginx** | **80/443** | 웹 서버 (HTTP/HTTPS) | 외부에서 직접 접근 |
| **PostgreSQL** | **5433** | 데이터베이스 | 개발/관리용 |
| **MySQL** | **3307** | 인보이스 데이터베이스 | 개발/관리용 |
| **Redis** | **6380** | 캐시/세션 저장소 | 개발/관리용 |
| **Kafka** | **29092** | 메시지 큐 | 개발/관리용 |
| **Airflow** | **58080** | 워크플로우 관리 | 개발/관리용 |
| **VLLM** | **8000** | LLM 서빙 | 개발/관리용 |
| **DCGM Exporter** | **9400** | GPU 모니터링 | 개발/관리용 |

### 내부 포트 (컨테이너 간 통신만)
| 서비스 | 내부 포트 | 설명 |
|--------|-----------|------|
| **Portal App** | 8001 | Django 웹 애플리케이션 |
| **MLflow** | 5001 | ML 실험 추적 |
| **MinIO** | 9000, 9001 | 객체 저장소 (API/Console) |
| **Grafana** | 3000 | 모니터링 대시보드 |
| **Superset** | 8088 | 데이터 시각화 |
| **Prometheus** | 9090 | 메트릭 수집 |
| **Loki** | 3100 | 로그 수집 |
| **OpenMeter** | 8888 | 사용량 측정 |
| **InvoiceNinja** | 9000 | 인보이스 관리 |
| **Kafka Connect** | 8083 | 데이터 커넥터 |
| **Promtail** | 9080 | 로그 수집기 |

### 🔐 통합 인증 포트
| 서비스 | 포트 | 설명 | 접근 방법 |
|--------|------|------|-----------|
| **Keycloak** | **8081** | 통합 인증 서비스 | 개발/관리용 |
| **OAuth2 Proxy (MLflow)** | **4180** | MLflow 인증 프록시 | 내부 통신만 |

### 포트 접근 정책
- **🔓 공개 포트**: 외부에서 직접 접근 가능 (개발/관리용)
- **🔒 내부 포트**: Docker 네트워크 내에서만 접근 가능
- **🌐 프록시**: Nginx를 통한 모든 외부 접근은 80/443 포트로 통합
- **🔐 보안**: Keycloak을 통한 통합 인증으로 내부 서비스 보호

## 📁 프로젝트 구조

```
solar-stack/
├── compose/          # Docker Compose 설정
├── git/             # 컨테이너별 커스터마이징 파일
├── cerbot/          # SSL 인증서 관리
├── ssl/             # SSL 인증서 저장
├── letsencrypt/     # Let's Encrypt 설정
└── README.md        # 프로젝트 문서
```

## 🚨 주의사항

- 프로덕션 환경 배포 전 충분한 테스트 필요
- 환경변수 파일의 민감한 정보 보호
- 정기적인 백업 및 모니터링 설정 권장

## 📝 개발 노트

이 프로젝트는 MLOps와 LLMOps를 위한 통합 스택으로, 각 서비스의 독립성과 상호 연동성을 고려하여 설계되었습니다. 현재 컨테이너별 연결 작업이 진행 중이며, 완성 후에는 전체 시스템 통합 테스트를 진행할 예정입니다.

